<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Banquinha Mobile | Portal de Aplicações</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <script>
        // Redirecionamento reverso de segurança (Execução imediata)
        var isMobileCheck = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        // Evita loop se já estiver na index
        if (isMobileCheck && !window.location.pathname.includes("index.html") && window.location.pathname !== "/") {
            window.location.replace("index.html");
        }
    </script>

    <style>
        :root {
            --primary: #FFD700;
            --primary-dark: #E6C200;
            --accent: #7C3AED;
            --dark: #0A0A0A;
            --dark-card: #141414;
            --dark-surface: #1A1A1A;
            --gray-400: #8C8C8C;
            --white: #FFFFFF;
            --gradient-primary: linear-gradient(135deg, #FFD700 0%, #FFE44D 50%, #FFC107 100%);
            --gradient-accent: linear-gradient(135deg, #7C3AED 0%, #8B5CF6 50%, #A78BFA 100%);
            --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.3);
            --font-heading: 'Space Grotesk', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--dark); color: var(--white); overflow-x: hidden; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }
        
        /* Header */
        .header { padding: 32px 0; }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .brand { display: flex; align-items: center; gap: 16px; }
        .logo { width: 52px; height: 52px; background: var(--gradient-primary); border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: var(--dark); }
        .brand-name { font-family: var(--font-heading); font-size: 1.75rem; font-weight: 800; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Hero */
        .hero { padding: 80px 0; text-align: center; }
        .hero-title { font-family: var(--font-heading); font-size: 3.5rem; margin-bottom: 24px; }
        .cta-button { background: var(--gradient-primary); color: var(--dark); padding: 14px 32px; border-radius: 12px; text-decoration: none; font-weight: 700; display: inline-flex; align-items: center; gap: 8px; border: none; cursor: pointer; transition: 0.3s; }
        .cta-button:hover { transform: translateY(-2px); }

        /* Cards */
        .platforms-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 32px; padding: 40px 0; }
        .platform-card { background: var(--dark-card); padding: 40px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.05); }
        .platform-icon { font-size: 40px; margin-bottom: 20px; color: var(--primary); }
        
        /* Modal QR */
        #qrModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: var(--dark-card); padding: 40px; border-radius: 24px; text-align: center; max-width: 400px; border: 1px solid var(--primary); }
        #qrcode-container { background: white; padding: 15px; border-radius: 10px; display: inline-block; margin: 20px 0; }

        .fade-in { opacity: 0; transform: translateY(20px); transition: 0.6s ease-out; }
        .fade-in.visible { opacity: 1; transform: translateY(0); }
    </style>
</head>

<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="brand">
                    <div class="logo"><i class="fas fa-store"></i></div>
                    <div class="brand-text">
                        <h1 class="brand-name">Smoking Bee</h1>
                    </div>
                </div>
                <nav>
                    <a href="mailto:suporte@labanquinha.com.br" class="cta-button">Suporte</a>
                </nav>
            </div>
        </div>
    </header>

    <section class="hero container">
        <div class="hero-content fade-in visible">
            <h1 class="hero-title">Portal de Aplicações <span style="color: var(--primary)">Smoking Bee</span></h1>
            <p style="color: var(--gray-400); margin-bottom: 40px;">Escolha a melhor experiência para o seu dispositivo.</p>
            <div class="hero-actions">
                <a href="#" class="cta-button download-apk-btn" id="heroDownloadBtn">
                    <i class="fab fa-android"></i> Baixar APK
                </a>
            </div>
        </div>
    </section>

    <section class="container">
        <div class="platforms-grid">
            <div class="platform-card fade-in visible">
                <i class="fab fa-android platform-icon"></i>
                <h3>Android Nativo</h3>
                <p style="margin: 15px 0; color: #aaa;">Melhor performance e notificações em tempo real.</p>
                <button class="cta-button" onclick="showApkQr()" style="width: 100%;">
                    <i class="fas fa-qrcode"></i> <span class="apk-btn-text">Gerar QR Code APK</span>
                </button>
            </div>

            <div class="platform-card fade-in visible">
                <i class="fab fa-apple platform-icon" style="color: var(--accent)"></i>
                <h3>iOS Web App</h3>
                <p style="margin: 15px 0; color: #aaa;">Otimizado para iPhone via Safari.</p>
                <a href="https://smokingbee.com.br" class="cta-button" style="background: var(--gradient-accent); width: 100%; justify-content: center;">
                    Acessar Loja
                </a>
            </div>
        </div>
    </section>

    <div id="qrModal">
        <div class="modal-content">
            <h3 id="modalTitle">Escanear com Celular</h3>
            <div id="qrcode-container"></div>
            <p id="modalDesc" style="font-size: 14px; color: #888;">Aponte a câmera para baixar.</p>
            <br>
            <button onclick="closeModal()" class="cta-button" style="padding: 10px 20px;">Fechar</button>
        </div>
    </div>

    <script>
        let finalDownloadStreamUrl = "";
        let isFetchingLink = false;

        function detectAbi() {
            let abi = 'armeabi-v7a';
            const ua = navigator.userAgent.toLowerCase();
            if (ua.includes('x86_64') || ua.includes('x64')) abi = 'x86_64';
            else if (ua.includes('arm64') || ua.includes('aarch64')) abi = 'arm64-v8a';
            return abi;
        }

        async function updateApkLinks() {
            if (isFetchingLink) return;
            isFetchingLink = true;

            const abi = detectAbi();
            const btnTexts = document.querySelectorAll('.apk-btn-text');
            const heroBtn = document.getElementById('heroDownloadBtn');
            
            try {
                const response = await fetch(`https://api.smokingbee.com.br/update-app?version=0&abi=${abi}&app_type=ecommerce`);
                if (!response.ok) throw new Error("Offline");
                const data = await response.json();

                if (data.download_url) {
                    const encodedUrl = encodeURIComponent(data.download_url);
                    finalDownloadStreamUrl = `https://api.smokingbee.com.br/download-stream?url=${encodedUrl}`;

                    btnTexts.forEach(t => t.textContent = `Gerar QR Code (${data.new_version || 'v1.0.5'})`);
                    if(heroBtn) heroBtn.href = finalDownloadStreamUrl;
                }
            } catch (e) {
                console.error("API Error:", e);
            } finally {
                isFetchingLink = false;
            }
        }

        async function showApkQr() {
            if (!finalDownloadStreamUrl) {
                const txt = document.querySelector('.apk-btn-text');
                txt.textContent = "Buscando link...";
                await updateApkLinks();
            }

            if (finalDownloadStreamUrl) {
                const container = document.getElementById("qrcode-container");
                container.innerHTML = "";
                new QRCode(container, {
                    text: finalDownloadStreamUrl,
                    width: 200, height: 200,
                    colorDark: "#000000", colorLight: "#ffffff"
                });
                document.getElementById('qrModal').style.display = 'flex';
            } else {
                alert("Erro ao obter link. Tente baixar direto pelo botão da página.");
            }
        }

        function closeModal() {
            document.getElementById('qrModal').style.display = 'none';
        }

        // Inicialização segura
        window.onload = () => {
            updateApkLinks();
            // Efeito Fade In
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('visible');
                });
            });
            document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
        };

        // Fechar modal no esc ou clique fora
        window.onclick = (e) => { if(e.target.id === 'qrModal') closeModal(); };
        document.onkeydown = (e) => { if(e.key === 'Escape') closeModal(); };
    </script>
</body>
</html>